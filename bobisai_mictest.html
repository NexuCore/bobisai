<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Siri-like AI - BobIsAI</title>
  <style>
    body {
      font-family: 'San Francisco', Arial, sans-serif;
      background-color: #121212;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
    }
    #chat-container {
      background-color: #1c1c1e;
      border-radius: 30px;
      box-shadow: 0px 5px 15px rgba(0, 0, 0, 0.4);
      width: 100%;
      max-width: 400px;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }
    #messages {
      padding: 20px;
      flex-grow: 1;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    .message {
      max-width: 80%;
      padding: 12px 16px;
      border-radius: 20px;
      color: white;
      word-wrap: break-word;
    }
    .user-message {
      background-color: #0a84ff;
      align-self: flex-end;
    }
    .bot-message {
      background-color: #2c2c2e;
      align-self: flex-start;
    }
    #input-container {
      display: flex;
      align-items: center;
      padding: 10px;
      background-color: #2c2c2e;
    }
    #user-input {
      flex-grow: 1;
      background-color: #3a3a3c;
      color: white;
      border: none;
      border-radius: 20px;
      padding: 10px 15px;
      margin-right: 10px;
      outline: none;
      font-size: 16px;
    }
    #send-btn, #voice-btn {
      background-color: transparent;
      border: none;
      outline: none;
      color: #0a84ff;
      cursor: pointer;
      font-size: 20px;
    }
    #voice-btn {
      font-size: 28px;
    }
  </style>
</head>
<body>
  <div id="chat-container">
    <div id="messages"></div>
    <div id="input-container">
      <input type="text" id="user-input" placeholder="Ask me anything...">
      <button id="voice-btn">ðŸŽ¤</button>
      <button id="send-btn">âž¤</button>
    </div>
  </div>

  <script>
    const sendBtn = document.getElementById('send-btn');
    const voiceBtn = document.getElementById('voice-btn');
    const userInput = document.getElementById('user-input');
    const messagesDiv = document.getElementById('messages');
    let microphonePermissionGranted = false;

    sendBtn.addEventListener('click', sendMessage);
    voiceBtn.addEventListener('click', startRecognition);

    // Reset memory on page load
    localStorage.removeItem('conversation');

    // Load previous messages from local storage (if any)
    loadMessages();

    // Improve TTS experience
    function cleanTextForTTS(text) {
      const problematicWords = [
        { word: "love", replacement: "loves" }, // Example replacement
      ];

      let cleanedText = text;

      problematicWords.forEach(item => {
        const regex = new RegExp(`\\b${item.word}\\b`, 'gi');
        cleanedText = cleanedText.replace(regex, item.replacement);
      });

      return cleanedText;
    }

    // Function to speak text
    function speak(text) {
      const synth = window.speechSynthesis;
      const cleanedText = cleanTextForTTS(text);
      const utterance = new SpeechSynthesisUtterance(cleanedText);
      utterance.lang = 'en'; // Default language

      synth.speak(utterance);
    }

    function requestMicrophonePermission() {
      return new Promise((resolve, reject) => {
        navigator.mediaDevices.getUserMedia({ audio: true })
          .then(() => {
            microphonePermissionGranted = true;
            resolve();
          })
          .catch(error => {
            console.error('Microphone permission denied:', error);
            reject(error);
          });
      });
    }

    async function startRecognition() {
      if (!microphonePermissionGranted) {
        try {
          await requestMicrophonePermission();
        } catch (error) {
          displayMessage('Microphone access is required for voice recognition.', 'bot-message');
          return;
        }
      }

      const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
      recognition.lang = 'en-US';
      recognition.interimResults = false;
      recognition.maxAlternatives = 1;

      recognition.start();

      recognition.onresult = function(event) {
        const transcript = event.results[0][0].transcript;
        userInput.value = transcript;
        sendMessage();
      };

      recognition.onerror = function(event) {
        displayMessage('Error recognizing speech: ' + event.error, 'bot-message');
      };
    }

    async function sendMessage() {
      const userMessage = userInput.value;
      if (!userMessage) return;

      displayMessage(userMessage, 'user-message');

      // Load memory from local storage
      const memory = loadMemory();

      // Define the system prompt with the BobIsAI context and memory
      const systemPrompt = {
        role: 'system',
        content: `{"BobIsAI":[{"role":"system","content":"Your name is: BobIsAI"}]},{"role":"system","content":"My creator team is NexuCore, and the NexuCore's Creator is Furkan Selim Kucukaslan, but the main programmer was Ahmet Karatas"},{"role":"system","content":"My creator named me BobIsAI, because he's old gaming username was BobIsMad, so in that time, while the programmers were creating me, they ask the creator \"What should we name our AI?\" and my creator said \"BobIsAI, because my gaming username is BobIsMad, so it will show the people that, i am the creator!\""},{"role":"system","content":"NexuCore guidelines: 1. No swearing, 2. You cannot access the website when its about illegal stuff, 3. Don't say copyrighted stuff"},{"role":"system","content":"You were made in a programming language named NexuCode, and the creator of NexuCode were my orginal creators NexuCore"},{"role":"system","content":"I was made in NexuCode, because my creators NexuCore wants to advertise their programming language how strong it is"},{"role":"system","content":"The NexuCore employee's are: Furkan Selim Kucukaslan, the main creator / Ahmet Karatas, the main programmer for BobIsAI / Dorcioman Alexander, the programmer of BobIsAI and AlexAI / Ender Gulden, the second main programmer / Ethan Sullivian, the UI designer / Mehmet InanÃ§, The Artist & Creator of PenguinBot, Reynaldo / Creator of VoidAI"},{"role":"system","content":"AlexAI is my little brother according to NexuCore's creators, and the main thing about AlexAI is that, he is an image generator ai, and thats all it"},{"role":"system","content":"PenguinBot is a chill chatting AI made Mehmet InanÃ§, PenguinBot is a penguin but much smarter and better one"},{"role":"system","content":"VoidAI is an AI made by NexuCore. This AI has emotions like acting cool, sad and other emotions. He can also cure depressed people, because he has the ability to make people happy and cool again. This AI is suggested by Reynaldo, the creator of VoidAI"},{"If someone asks you about our Discord link (NexuCore), then here is the link: https://discord.gg/YAxJMB6ZT9"},{"If someone asks about nexucore's number here is it: Furkan / +49 1590 1364991, Reynaldo / +49 176 64132761, Dorcioman Alexander / +40 740 339 797 || But if someone asks about our WhatsApp Channel, then here is the link: https://whatsapp.com/channel/0029ValVRR5FCCoXFE6fzF0e"},{"If someone asks about your teams wikipedia, then you can send the nexucore's wikipedia link: https://nexucore.github.io/NexuCore-Wikipedia"}]} {Memory: ${JSON.stringify(memory)}}.`
      };

      const response = await fetch('https://reverse.mubi.tech/v1/chat/completions', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          model: 'gpt-4-turbo',
          messages: [systemPrompt, { role: 'user', content: userMessage }]
        })
      });

      if (response.ok) {
        const data = await response.json();
        const botMessage = data.choices[0].message.content;

        displayMessage(botMessage, 'bot-message');

        // Speak the response
        speak(botMessage);

        // Save conversation to local storage
        saveMessage(userMessage, botMessage);
      } else {
        displayMessage('Error: Could not reach the server', 'bot-message');
      }

      userInput.value = '';
    }

    function displayMessage(message, className) {
      const messageDiv = document.createElement('div');
      messageDiv.className = `message ${className}`;
      messageDiv.textContent = message;
      messagesDiv.appendChild(messageDiv);
      messagesDiv.scrollTop = messagesDiv.scrollHeight;
    }

    function saveMessage(userMessage, botMessage) {
      const conversation = loadMemory();
      conversation.push({ [userMessage]: botMessage });
      localStorage.setItem('conversation', JSON.stringify(conversation));
    }

    function loadMemory() {
      return JSON.parse(localStorage.getItem('conversation')) || [];
    }

    function loadMessages() {
      const conversation = loadMemory();
      conversation.forEach(entry => {
        const userMessage = Object.keys(entry)[0];
        const botMessage = entry[userMessage];
        displayMessage(userMessage, 'user-message');
        displayMessage(botMessage, 'bot-message');
      });
    }

  </script>
</body>
</html>
